version: v1.0
name: Deploy to production
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Deploy to production
    task:
      secrets:
        - name: gfile
      prologue:
        commands:
          - checkout
      jobs:
        - name: exec deploy
          commands:
            - cat /home/semaphore/gcloud.json
            - >-
              gcloud auth activate-service-account
              --key-file=/home/semaphore/gcloud.json
            - >-
              gcloud compute --project "smart-rope-243709" ssh --zone
              "europe-west3-c" "atome-01" --command="sudo cd
              /home/publifactory/web-app/ && git pull origin master"
            - >-
              gcloud compute --project "smart-rope-243709" ssh --zone
              "europe-west3-c" "atome-01" --command="sudo
              /home/publifactory/web-app/script_docker.sh start prod"
    dependencies: []
