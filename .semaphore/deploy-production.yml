version: v1.0
name: Deploy to production
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Deploy to production
    task:
      secrets:
        - name: gfile
      prologue:
        commands:
          - checkout
      jobs:
        - name: exec deploy
          commands:
            - ls /home/semaphore/
            - sudo chmod 600 /home/semaphore/ssh
            - sudo locale-gen en_US.UTF-8
            - >-
              ssh -o "StrictHostKeyChecking no" -i /home/semaphore/ssh collin_q@35.246.243.12 
              "cd /home/publifactory;
              git pull https://publifactory:C8R%3CyFD%5B3S%26%40jW8T@github.com/publifactory/web-app.git;
              cd web-app;
              sudo ./script_docker.sh start prod"
              # mv web-app/database/ .;
              # rm -rf web-app; 
              # git clone -b master https://publifactory:C8R%3CyFD%5B3S%26%40jW8T@github.com/publifactory/web-app.git;
              # mv database/ ./web-app/;

              # sudo chmod 770 -R web-app
              # sudo chown -R collin_q:publifactory-team web-app
    dependencies: []
