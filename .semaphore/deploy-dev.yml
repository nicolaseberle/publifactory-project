version: v1.0
name: Deploy to dev
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Deploy to dev
    task:
      secrets:
        - name: gfile
      prologue:
        commands:
          - checkout
      jobs:
        - name: exec deploy
          commands:
            - ls /home/semaphore/
              # ssh -i /home/semaphore/ssh.json collin_q@34.89.179.162
            - >-
              gcloud auth activate-service-account
              --key-file=/home/semaphore/gcloud.json
            - >-
              gcloud compute --project "smart-rope-243709" ssh --zone 
              "europe-west3-c" "atome-01-dev"
              --ssh-key-file=/home/semaphore/ssh.json
              --command="cd /home/publifactory/web-app && git pull origin dev"
            - >-
              gcloud compute ssh --project "smart-rope-243709" ssh --zone
              "europe-west3-c" "atome-01-dev" --command="sudo
              /home/publifactory/web-app/script_docker.sh start prod"
    dependencies: []
