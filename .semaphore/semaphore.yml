version: v1.0
name: First pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Deployement
    task:
      prologue:
        commands:
          - checkout
      jobs:
        - name: 'GCLOUD: Auth'
          commands:
            - >-
              gcloud auth activate-service-account
              --key-file=smart-rope-243709-b0d81484d55d.json
        - name: 'GCLOUD: Pull Branch'
          commands:
            - >-
              gcloud compute --project "smart-rope-243709" ssh --zone
              "europe-west3-c" "atome-01" --command="sudo cd
              /home/publifactory/web-app/ && git pull origin dev"
        - name: 'GCLOUD: Exec Script Docker'
          commands:
            - >-
              gcloud compute --project "smart-rope-243709" ssh --zone
              "europe-west3-c" "atome-01-dev" --command="sudo
              /home/publifactory/web-app/script_docker.sh start prod"
    dependencies: []
